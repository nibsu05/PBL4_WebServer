@model List<PBL3.DTO.Buyer.ExchangeStuffDTO>
@using PBL3.Enums

@{
    Layout = "~/Views/Shared/BuyerLayout.cshtml";
    var tabs = new List<(string Label, ExchangeStatus? Status)>
    {
        ("T·∫•t c·∫£ ƒë∆°n", null),
        ("Ch·ªù x·ª≠ l√Ω", ExchangeStatus.WaitConfirm),
        ("ƒê√£ ch·∫•p nh·∫≠n", ExchangeStatus.Approved),
        ("B·ªã t·ª´ ch·ªëi", ExchangeStatus.Rejected),
    };
    string GetStatusBadge(ExchangeStatus status)
    {
        return status switch
        {
            ExchangeStatus.WaitConfirm => "üïí Ch·ªù x·ª≠ l√Ω",
            ExchangeStatus.Approved => "‚úÖ ƒê√£ ch·∫•p nh·∫≠n",
            ExchangeStatus.Rejected => "‚ùå B·ªã t·ª´ ch·ªëi",
            _ => "Kh√¥ng x√°c ƒë·ªãnh"
        };
    }

    string GetStatusColor(ExchangeStatus status)
    {
        return status switch
        {
            ExchangeStatus.WaitConfirm => "bg-yellow-100 text-yellow-700",
            ExchangeStatus.Approved => "bg-green-100 text-green-700",
            ExchangeStatus.Rejected => "bg-red-100 text-red-700",
            _ => "bg-gray-100 text-gray-600"
        };
    }
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Y√™u c·∫ßu ƒë·ªïi/tr·∫£</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div class="flex">
    <!-- Sidebar -->
    <div class="w-1/4 pr-4 border-r border-gray-300">
        @Html.Partial("~/Views/Shared/_BuyerMenuLayout.cshtml")
    </div>

    <!-- Main content -->
    <div class="w-3/4 pl-4">
        <h2 class="text-2xl font-bold mb-4 text-green-700">Y√™u c·∫ßu ƒë·ªïi/tr·∫£</h2>
        <div class="flex space-x-4 mb-6 border-b border-gray-300 pb-2">
            @foreach (var tab in tabs)
            {
                var isActive = ViewBag.CurrentStatus == tab.Status;
                <a asp-action="ReturnExchangeHome" asp-route-status="@(tab.Status?.ToString())"
                   class="px-4 py-2 rounded-t-md text-sm font-semibold transition-all duration-200
                        @(isActive
                            ? "bg-green-700 text-white shadow-md"
                            : "text-gray-600 hover:text-green-700 hover:bg-gray-100")">
                    @tab.Label
                </a>
            }
        </div>
        @if (!Model.Any())
        {
            <div class="text-gray-500 italic">B·∫°n ch∆∞a g·ª≠i y√™u c·∫ßu ƒë·ªïi/tr·∫£ n√†o.</div>
        }
        else
        {
            @foreach (var item in Model)
            {
                var statusBadge = GetStatusBadge(item.Status);
                var statusColor = GetStatusColor(item.Status);

                <div class="border border-gray-300 rounded-lg p-4 mb-6 shadow hover:shadow-lg transition-shadow duration-200">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex flex-col">
                            <span class="text-green-700 font-semibold">Y√™u c·∫ßu #@item.ReturnExchangeId</span>
                            <span class="text-sm text-gray-500">ƒê∆°n h√†ng ID: @item.OrderId</span>
                            <span class="text-sm text-gray-500">Ng√†y g·ª≠i: @item.RequestDate.ToString("dd/MM/yyyy")</span>
                        </div>
                        <div class="px-3 py-1 rounded-full text-sm font-medium @statusColor">
                            @statusBadge
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-3 border-t pt-3">
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 bg-gray-100 border border-gray-300 rounded overflow-hidden flex items-center justify-center">
                                @{
                                    var base64Image = item.ProductImage != null
                                        ? $"data:image/jpeg;base64,{Convert.ToBase64String(item.ProductImage)}"
                                        : null;
                                }
                                @if (base64Image != null)
                                {
                                    <img src="@base64Image" alt="·∫¢nh s·∫£n ph·∫©m" class="w-full h-full object-cover" />
                                }
                                else
                                {
                                    <span class="text-gray-400 text-xs">Kh√¥ng c√≥ ·∫£nh</span>
                                }
                            </div>
                            <div>
                                <div class="font-medium">@item.ProductName</div>
                                <div class="text-sm text-gray-500">S·ªë l∆∞·ª£ng: @item.Quantity</div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="flex justify-end items-center mt-4 border-t pt-4">
                        <a asp-action="ReturnExchangeDetail" asp-route-id="@item.ReturnExchangeId"
                           class="bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded shadow">
                            Xem chi ti·∫øt
                        </a>
                    </div>
                </div>
            }
        }
    </div>
</div>
</body>
</html>
